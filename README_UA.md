<h1 align="center">ESP32-Tester</h1>

![usb-tester](https://img.shields.io/badge/usb-tester-red?style=flat&logo=educative)
![programming](https://img.shields.io/badge/programming-blue?style=flat&logo=cplusplus)
![ESP32](https://img.shields.io/badge/ESP32-gray?style=flat&logo=espressif)

![IMG_20240528_201432](https://github.com/Vispixad/ESP32-USB-Tester/assets/161984981/5fde4f38-2ab2-40d2-ab2c-9211365a272d)

> [!CAUTION]
> Якщо у вас виникають помилки або інші труднощі, радимо стежити за
> оновленнями, а також писати про це нам, оскільки проект перебуває в активній розробці.
> Якщо ви важко розумієте російську мову, виберіть версію з зручнішою для вас мовою: English -> **Русский** -> Русский

ESP32-Tester – це DIY варіант USB тестерів від різних виробників, зроблений на основі ESP32-S3N16R8. Я реалізував багато різних функцій від простого вимірювання напруги, струму, підрахунку ват (V, A, W) – до перегляду
протоколів, які може видати ваш блок живлення, вимірювання опору кабелю та іншого. Проект досі перебуває у розробці та прошивка з кожним днем ​​розширюється як і його можливості.

## Зміст
- [**Що таке USB Tester?**](#що-таке-usb-tester)
- [**Компоненти**](#Компоненти)
 - [Дисплей](#дисплей)
 - [INA3221 (АЦП)](#ina3221-ацп)
 - [MPU-9250 (акселерометр, гіроскоп, компас)](#mpu-9250-акселерометр-гіроскоп-компас)
 - [ESP32-S3N16R8](#esp32-s3n16r8)
- [**Інтерфейс**](#Інтерфейс)
 - [Головне меню](#головне-меню)
 - [NGR меню](#ngr-меню)
 - [Графіки](#графіки)
 - [Application](#application)
- [**Fast Charge**](#fast-charge)
 - [Warning](#warning)

## Що таке USB Tester?
**USB Tester** – це пристрій, який використовується для вимірювання різних параметрів USB-портів або USB-кабелів, таких як напруга, струм та потужність, а також для тестування функціональності USB-пристроїв.

Це корисний інструмент як для звичайних користувачів, так і для професіоналів у цій галузі. USB Tester може бути представлений у вигляді невеликого приладу, який підключається до порту USB комп'ютера або зарядного пристрою або оснащуватися дисплеєм, який показує основні значення, що надходять через USB-порт. Більш просунуті USB Testerи також можуть надавати інформацію про протоколи заряджання (наприклад, Apple, Qualcomm Quick Charge, Samsung AFC) та багато іншого.

Його основна функція полягає в тому, щоб допомогти користувачам перевірити працездатність USB-портів на пристрої, а також оцінити якість зарядки різних пристроїв, включаючи мобільні телефони, планшети, навушники та інші гаджети. Він також може бути використаний для перевірки відповідності пристроїв стандартам USB.
<h1 align="center">Компоненти</h1>

## Дисплей
У своєму проекті я використовував комопненти, доступні на майданчику AliExpress, також купував у місцевих магазинах. Перше що ми зможемо побачити в тестері це сам дисплей, я вибрав **IPS 2 inch (240*320)**, він має гарну передачу кольору, щільність пікселів і технологію IPS, що дає хороші кути огляду в порівнянні з TFT, таким чином він чудово підходить для цього проекту.

![TFT-2 0-inch-IC-ST7789V-RGB-240x320-SPI-wymiary](https://github.com/Vispixad/ESP32-USB-Tester/assets/161984981/62fba501-9909-4379-d13d091512f1)

## INA3221 (АЦП)
Наступне, що ми можемо побачити після включення пристрою, це основні дані: V, A, W, для цієї мети я придбав АЦП **INA3221**. Це цифровий триканальний датчик струму та напруги з шиною I2C, нам будуть потрібні кілька каналів, оскільки є 2 вхідні (USB-A, USB Type-C) і 2 вихідні (USB-A, USB Type-C). Також він зручний тим, що має безліч індикаторів для визначення помилок у роботі, що цілком можна додати до свого проекту:

![ina3221_3265472](https://github.com/Vispixad/ESP32-USB-Tester/assets/161984981/86a92149-87d6-4b74-b699-448245379324)

- **LED1** – індикатор наявності живлення.
- **LED2** - живлення знаходиться в запрограмованому діапазоні (0 - 26 вольт)
- **LED3** — критична проблема як невірна полярність або коротке замикання (канал CRI)
- **LED4** — помилка виміру (Канал WAR)
- **LED5** — обрив лінії живлення одного із трьох висновків (Канал ТЗ).

Докладніше можете ознайомитись на різних сайтах, а ми продовжимо.

## MPU-9250 (акселерометр, гіроскоп, компас)
У тестера є функція повороту дисплея при нахилі (аналогічне є у вашому смартфоні), для такого використовується MPU-9250 - це 9-осьовий пристрій
(3-х осьовий акселерометр, 3-х осьовий гіроскоп, 3-х осьовий компас магнітометр). Як бачимо, є запас у вигляді компаса (тому якщо 9250 у вас коштує дорого, беріть MPU6500), але поки не знайшов йому застосування в даному
пристрої, у свою чергу гіроскоп і акселерометр використовуються для функції повороту дисплея.

![513VIvLM-HL](https://github.com/Vispixad/ESP32-USB-Tester/assets/161984981/6e5f72e5-f634-4b9b-84ae-83aaca236cd1)

## ESP32-S3N16R8
Далі йдуть різні порти, кнопки, обв'язування та сама плата МК - це ESP32-S3N16R8. Вона має 16Мб постійної пам'яті (PSRAM), 8Мб оперативної (RAM). Цього із надлишком вистачає для такого проекту, але не обов'язково брати версію з 8Мб RAM – ви її не зможете повністю забити.

![scale_1200](https://github.com/Vispixad/ESP32-USB-Tester/assets/161984981/34f7b422-d83c-4f71-b241-abdde5182c83)

<h1 align="center">Інтерфейс</h1>

## Головне меню
![IMG_20240528_162028](https://github.com/Vispixad/ESP32-USB-Tester/assets/161984981/4a0813a4-f7ec-45e7-909a-f29be2995bdc)
Перейдемо до інтерфейсу самого тестера, при запуску нас зустрічає головне меню з основними показаннями, температурою самого пристрою (дані беруться з вбудованого температурного датчика ESP32) та індикатор **stop/start**, нижче прописані дії для кнопок на цьому меню:
- **Натискання (середня кнопка)** - stop/start показань (для перегляду даних, якщо потрібно)
- **Натискання (права кнопка)** - перехід на наступне меню
- **Утримання (середня кнопка)** - кількість вимірювань показань у сік (йдуть по колу 5 – 50 – 1000)

## NGR меню
![IMG_20240528_171536](https://github.com/Vispixad/ESP32-USB-Tester/assets/161984981/7a422ec2-4542-4a1c-abb6-830a2bd5b0a4)
Тут є відображення основних даних (V, A, W), але вже додається показ даних на **DATA** контактах **(D+, D-)**, невелика область для показу даних з певного осередку (пізніше буде розбір), показ до 3-х можливих протоколів заряджання
для загальної інформації, чи тригер **(NONE/QC2.0...)**, запис даних:
- **Вкл - ONLINE**
- **Вимк - OFFLINE**
(шкала показує пам'ять пристрою, що залишилася, точніше області яка для цього виділена в пам'яті) і ліміт часу. Також з дрібного інтерфейсу є стрілка для показу напрямку в який порт підключено та шкала, яка заповнюється залежно від даних.

## Графіки
![IMG_20240304_130422](https://github.com/Vispixad/ESP32-USB-Tester/assets/161984981/a5f01732-1c56-4ccc-8536-27ed29358283)
Наступне третє меню - це меню графіків, їх тут 3 види:
- **Графік V/A** - (напруга, струм)
- **Графік D+/D-** - (плюс та мінус DATA контактів)
- **Графік CC1/CC2** - (CC1 та CC2).
На кожному з них можна зробити паузу аналогічно до головного меню. Тестер сам підбирає діапазон відображення, щоб було видно криву і не виходило за кордон.

> [!IMPORTANT]
> Варто також зазначити, що у графіку **CC1/CC2**, якщо у вас не підключено пристрій по **USB-C** або вхід підключений до USB-A тестер вам про це повідомить і пропустить цей графік через відсутність таких контактів, приклад показаний нижче:
>
> ![IMG_20240528_172332](https://github.com/Vispixad/ESP32-USB-Tester/assets/161984981/4465e063-705b-473b-a3e9-96949952094e)

## Application
![IMG_20240528_185722](https://github.com/Vispixad/ESP32-USB-Tester/assets/161984981/2edf4742-6736-4471-9b1c-fd436cc80ed9)
Останнє дочірнє меню це - меню додатків або **Application**, тут у прямокутниках йдуть розгалуження на інші підменю, про які написано нижче.

Також внизу показується **час роботи пристрою**, що може бути корисним у деяких випадках. З приводу управління:
- **натискання (кнопка вперед)** ми вибиратимемо різні підкатегорії (обрана відзначається синім).
- **натискання (кнопка назад)** ми перейдемо на попереднє меню.
- **натискання (середня кнопка)** зробить перехід у підменю чи підкатегорію.

<h1 align="center">Fast Charge</h1>

## Warning
![IMG_20240528_185651](https://github.com/Vispixad/ESP32-USB-Tester/assets/161984981/b84a39c4-2723-43bd-a3df-f53ae74e62f6)

При заході в підкатегорію **Fast Charge** нас зустрічає попередження, нижче за 3 пункти на вибір:
- **READY** - перехід у тригери швидкої зарядки (Samsung AfS, QC2.0, 3.0 та інше).
- **AUTO** - перехід у сканування вашого блоку живлення на наявність того чи іншого протоколу заряджання.
- **CANCEL** - вихід із підкатегорії.

## Detection v1.4
![IMG_20240528_221609](https://github.com/Vispixad/ESP32-USB-Tester/assets/161984981/61513ae1-aaef-4ae7-a267-e4cec1c8b75c)
Розберемо випадок натискання на пункт **AUTO**, вгорі написана версія детектування, статус - **Testig або Finish**, далі нижче по черзі тестується кожен протокол на наявність його в БП, методом виклику (тригер).

> [!NOTE]
> Докладніше про протоколи та їх роботу з Arduino сумісними платами можна за посиланнями нижче:
>
> [Що таке швидка зарядка](https://ru.wikipedia.org/wiki/%D0%9F%D1%80%D0%BE%D1%82%D0%BE%D0%BA%D0%BE%D0%BB%D1%8B_%D0%B1%D1%8B%D1%81%D1%82%D1%80%D0%BE%D0%B9_%D0%B7%D0%B0%D1%80%D1%8F%D0%B4%D0%BA%D0%B8) -> [Інтеграція QC2.0 в Arduino](https://github.com/GyverLibs/QuickCharge)
